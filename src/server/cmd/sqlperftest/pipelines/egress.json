{
    "pipeline": {
        "name": "egress"
    },
    "description": "Measure the time it takes to write results back to DB.",
    "input": {
        "pfs": {
            "glob": "/data/tpch_sf1.*",
            "repo": "ingress",
            "name": "input"
        }
    },
    "transform": {
        "cmd": [
            "sh"
        ],
        "stdin": [
            "mkdir -p /pfs/out/stats",
            "FILES=/pfs/input/data/*",
            "for f in $FILES",
            "do",
            "/app/sqlperftest egress csv $f 'snowflake://albert@WDEUWUD-CJ80497/PERF_TEST_EGRESS?warehouse=COMPUTE_WH' > /pfs/out/stats/$(basename $f).csv",
            "done"
        ],
        "image": "albertpachyderm/sqlperftest:test",
        "secrets": [
            {
                "name": "snowflakesecret",
                "env_var": "PACHYDERM_SQL_PASSWORD",
                "key": "PACHYDERM_SQL_PASSWORD"
            }
        ]
    },
    "datum_tries": 1,
    "parallelism_spec": {
        "constant": 8
    }
}